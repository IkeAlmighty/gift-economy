// Script to initialize BaseController and generate renderer API file
import { BaseController } from "./src/controller/index.mjs";
import fs from "node:fs";
import path from "node:path";
import { fileURLToPath } from "node:url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Initialize the BaseController (registers all handlers)
const baseController = await BaseController.initialize({
  controllersDirectories: [path.join(__dirname, "src", "controller")],
  usecasesDirectories: [path.join(__dirname, "src", "application", "use-cases")],
});

// Get all registered handler names
const handlerNames = Object.keys(baseController.handlers);

// Generate the API file content
let apiFileContent = "";

apiFileContent += `// This file is auto-generated by build-renderer-api.js
// It exports all registered handler names from the BaseController
// Do not edit this file directly, as it will be overwritten automatically.

// Function signatures use rest parameters to capture all arguments;
// Reference DTO structures corresponding to resource (ie createListing -> ListingDTO).
`;

handlerNames.forEach((name) => {
  apiFileContent += `
export async function ${name}(payload) {
  return controllerAPI.invoke("${name}", payload);
}
`;
});

// Write to src/renderer/api.js
const apiFilePath = path.join("src", "renderer", "api.js");
fs.writeFileSync(apiFilePath, apiFileContent, "utf-8");
console.log(`API file generated with handlers:`, handlerNames);
